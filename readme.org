Install and force logrotate to test
#+begin_src sh
sudo ./install.sh
sudo logrotate -f /etc/logrotate.d/rtl433-tpms
sleep 2
sudo logrotate -f /etc/logrotate.d/rtl433-tpms
ls -1 /var/log/rtl_433/tpms | tail -n 10
#+end_src


#+begin_src sh
grep --text -E '^\s*\{.*\}\s*$' all.jsonl > cleaned.jsonl
#+end_src


Combine all gzipped logfiles
#+begin_src sh
zcat -f /var/log/rtl-433/tpms/tpms_current.jsonl* > combined.jsonl
#+end_src

Or just some days
#+begin_src sh
zcat -f /var/log/rtl_433/tpms/tpms_current.jsonl-2026-01-{21..26}_*.gz > combined_2026-01-21_26.jsonl
#+end_src


#+begin_src sh
python tpms.py '/var/log/rtl_433/tpms/tpms_current.jsonl-2026-01-*.gz' \
  --start 2026-01-21 --end 2026-01-26 \
  --id 251 --window-minutes 40 --show
#+end_src


Count and sort IDs,
#+begin_src sh
zcat -f /var/log/rtl_433/tpms/tpms_current.jsonl* \
  | jq -Rr 'fromjson? | select(.id? != null) | [(.model // "UNKNOWN"), (.id|tostring)] | @tsv' \
  | sort \
  | uniq -c \
  | sort -nr
#+end_src

Test prometheus exporter
#+begin_src sh
curl -s http://127.0.0.1:9123/metrics | grep rtl433_temperature_c | head
#+end_src

#+begin_src sh
python3 jsonl_to_openmetrics.py < /var/log/rtl_433/tpms/tpms_current.jsonl > backfill.om
nix shell nixpkgs#prometheus.cli
sudo -u prometheus promtool tsdb create-blocks-from openmetrics backfill.om /var/lib/prometheus2/data
#+end_src
